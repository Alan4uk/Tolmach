$(function(){if($("select").size()){$("select").select()}}),$.fn.select=function(e){{var s=$.fn.select.method,t=jQuery.Event("itemClick"),a=jQuery.Event("selectReady");jQuery.Event("enabled"),jQuery.Event("disabled"),jQuery.Event("destroyed")}if("string"==typeof e&&e in $.fn.select.method){var i=$(this);return s[e](i,arguments[1]),$(this)}"method"in $.fn.select||($.fn.select.method={destroy:function(s){if(!s.data("customized"))throw new Error("объект не проинициализирован");s.off("change"+e.namespace),s.each(function(){var e=$(this);e.data("customSelect").remove(),$(document).off("mousedown",e.data("mousedownHandler")),$(window).off("resize",e.data("resizeHandler"))}),s.removeData(),s.trigger("destroyed")},enable:function(s){s.data("disable")&&(s.attr("disabled",!1),s.data("customSelect").first().on("click"+e.namespace,s.data("openerHandler")).removeClass("disabled"),s.trigger("enabled"))},disable:function(e){e.data("disable")||(e.data("disable",!0),e.attr("disabled",!0),e.data("openerHandler",$._data(e.data("customSelect").first().get(0),"events").click[0].handler),e.data("customSelect").first().off("click").addClass("disabled"),e.trigger("disabled"))},pick:function(s,t){s.each(function(){this.selectedIndex=t}),s.trigger("change"+e.namespace)}},s=$.fn.select.method),e=$.extend({list:"ul",namespace:".select",item:"li",itemHTML:"li span",openerClass:"selectmenu",icoClass:"selectmenu-icon",selectedClass:"selectmenu-status",activeItemClass:"active",activeOpenerClass:"active",dropDownClass:"selectmenu-menu",style:"dropdown",transferClass:!0,dropdownHasBorder:!0,hasIcons:!0,resizable:!1,triggerEvents:!0},e);var i=[],d=$("body"),n=$('<a class="'+e.openerClass+'"><span class="'+e.icoClass+'"></span><span class="'+e.selectedClass+'"></span></a>'),l=$("<div class="+e.dropDownClass+'><div class="select-top"><div class="select-l"></div><div class="select-r"></div></div><div class="select-c"><div class="c appendHere"></div></div><div class="select-bottom"><div class="select-l"></div><div class="select-r"></div></div></div>');if($(this).each(function(){$(this).data("customized")||i.push(this)}),!i.length)throw Error('селектор $("'+$(this).selector+'") ничего не возвратил');$(i).each(function(){function s(){if("dropdown"==e.style){var s=i.offset().top+i.outerHeight(),t=i.offset().left;h.css({top:s,left:t})}else{var a=v.eq(c.get(0).selectedIndex);a=a.hasClass("title")?a.next():a;var s=i.offset().top-a.position().top,t=i.offset().left;h.css({top:s,left:t})}}var i=n.clone(),c=$(this),o=c.find("option[title]").text(),r=c.find("option[title]").attr("disabled",!0).end().find("option"),f=r.size()-1,h=l.clone(),p=e.itemHTML.split(" "),u=p.length>=2,m="<"+e.list+">";c.find("option").each(function(s,t){if($(this).attr("title"))m+="<"+e.item+" class='title' style='display:none;'>"+t.childNodes[0].nodeValue+"</"+e.item+">";else if(u){for(var a="",i=p.length-1;0!=i;i--)a?0!=i&&p.length>2&&(a="<"+p[i]+">"+a+"</"+p[i]+">"):a+="<"+p[i]+">"+t.childNodes[0].nodeValue+"</"+p[i]+">";a="<"+p[0]+">"+a+"</"+p[0]+">",m+=a}else m+="<"+e.item+">"+t.childNodes[0].nodeValue+"</"+e.item+">";s==f&&(m+="</"+e.list+">")}),m=$(m),h=h.find(".appendHere").removeClass("appendHere").append(m).end(),i.insertAfter(c),i.find("."+e.selectedClass).text(c.find("option:selected").text()),d.append(h),e.dropdownHasBorder?h.width(i.width()):h.width(i.outerWidth()),e.transferClass&&(i.addClass(i.attr("class")+" "+c.attr("class")),h.addClass(h.attr("class")+" "+c.attr("class"))),$(this).data("customSelect",i.add(h)),$(this).data("customized",!0);{var v=m.find(">"+e.item),g=h.outerWidth();h.outerHeight()}selectedByHover="",selected="",e.resizable?$(window).on("resize.opener",function(){g=e.dropdownHasBorder?h.width(i.width()):h.width(i.outerWidth())}).trigger("resize.opener"):(i.width(c.outerWidth()),g=e.dropdownHasBorder?h.width(i.width()):h.width(i.outerWidth())),o&&(i.find("."+e.selectedClass).text(o),c.trigger("change"+e.namespace,[r.filter(":selected").index()])),c.on("change"+e.namespace,function(s,t,a,d){d||(t||0===t||(t=this.selectedIndex),this.selectedIndex=t,v.removeClass(e.activeItemClass).eq(t).addClass(e.activeItemClass),selected=r.eq(t),i.find("."+e.selectedClass).text(selected.text()),a||(h.hide(),i.removeClass(e.activeOpenerClass)),c.trigger("change",[null,null,!0]))}),e.hasIcons&&(r.each(function(e){v.eq(e).prepend('<span class="icon '+this.className+'"></span>')}),c.on("change"+e.namespace,function(s,t,a,d){d||i.find("."+e.selectedClass).prepend('<span class="'+selected.attr("class")+'"></span>')}),i.find("."+e.selectedClass).prepend('<span class="'+r.filter(":selected").attr("class")+'"></span>')),c.hide(),v.click(function(){$(this).hasClass(e.activeItemClass)||c.trigger("change"+e.namespace,[$(this).index()]),h.hide(),i.removeClass(e.activeOpenerClass)}),i.click(function(){h.is(":hidden")?(h.show(),i.addClass(e.activeOpenerClass),s()):(h.hide(),i.removeClass(e.activeOpenerClass))}),c.data("resizeHandler",function(){console.log("resizeHandler"),h.is(":visible")&&s()}),c.data("mousedownHandler",function(s){console.log("mousedownHandler"),$(s.target).closest(h).size()||$(s.target).closest(i).size()||(h.hide(),i.removeClass(e.activeOpenerClass))}),$(window).on("resize",c.data("resizeHandler")),$(document).on("mousedown",c.data("mousedownHandler")),e.triggerEvents&&(v.click(function(){c.trigger(t,[$(this).text()])}),c.trigger(a,[h])),c.is(":disabled")&&c.select("disable")})};